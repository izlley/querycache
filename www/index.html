<html>
<head>
    <meta charset="utf-8" />
    <title>QueryCache</title>
    <style type="text/css">
    @import '/bootstrap/css/bootstrap.min.css';
    @import '/bootstrap/css/bootstrap-select.min.css';
    @import '/css/querycache.css';
    </style>
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script src="/bootstrap/js/bootstrap.min.js"></script>
    <script src="/bootstrap/js/bootstrap-select.min.js"></script>
    <script src="/js/string.js"></script>
    <script src="/js/utils.js"></script>
</head>
<script type="text/javascript">
var g_running_queries = [];
var g_complete_queries = [];
var g_connection_pool = [];
var g_object_pool = null;

function getAll() {
    $.getJSON('/api/queries', function(result) {
        var contents = '';
        g_running_queries = result.runningQueries;
        for (var i=0; i<g_running_queries.length; i++) {
            var q = g_running_queries[i];
            contents += '<tr><td>'+q.queryId+'</td><td>'+q.connType+'</td><td>'+q.user+'</td><td>'+q.queryStr+'</td><td>'+q.clientIp+'</td><td>'+q.rowCnt+'</td><td>'+formatDate(new Date(q.startTime))+'</td><td>'+(q.endTime - q.startTime)+'</td></tr>';
        }
        $('#queriesinflight tbody').html(contents);

        contents = '';
        g_complete_queries = result.completeQueries;
        for (var i=0; i<g_complete_queries.length; i++) {
            var q = g_complete_queries[i];
            contents += '<tr><td>'+q.queryId+'</td><td>'+q.connType+'</td><td>'+q.user+'</td><td>'+q.queryStr+'</td><td>'+q.clientIp+'</td><td>'+q.rowCnt+'</td><td>'+formatDate(new Date(q.startTime))+'</td><td>'+(q.endTime - q.startTime)+'</td></tr>';
        }
        $('#queriescomplete tbody').html(contents);
    });
    $.getJSON('/api/connections', function(result) {
        var contents = '';
        g_connection_pool = result;
        for (var i=0; i<g_connection_pool.length; i++) {
            var p = g_connection_pool[i];
            contents += '<tr><td>'+p.driver+'</td><td>'+p.free+'</td><td>'+p.using+'</td></tr>';
        }
        $('#connpool tbody').html(contents);
    });
    $.getJSON('/api/objectpool', function(result) {
        var contents = '';
        g_object_pool = result;
        var p = g_object_pool;
        contents += '<tr><td>TROWSET</td><td>'+p.poolSize[0]+'</td></tr>';
        contents += '<tr><td>TROW</td><td>'+p.poolSize[1]+'</td></tr>';
        contents += '<tr><td>TCOLUMNVALUE</td><td>'+p.poolSize[2]+'</td></tr>';
        contents += '<tr><td>TSTRINGVALUE</td><td>'+p.poolSize[3]+'</td></tr>';
        $('#objpool tbody').html(contents);
    });
}

$(function() {
    getAll();
});

</script>
<body>
<H1>QueryCache</H1>

<H2>Connection Pool Stats</H2>
<div class="container-fluid">
    <table class="table" id="connpool">
    <thead><tr>
        <th>backend</th><th>free</th><th>in use</th>
    </tr></thead>
    <tbody>
    </tbody>
    </table>
</div>

<H2>Object Pool Stats</H2>
<div class="container-fluid">
    <table class="table" id="objpool">
    <thead><tr>
        <th>obj type</th><th>free</th>
    </tr></thead>
    <tbody>
    </tbody>
    </table>
</div>

<H2>In-Flight Queries</H2>
<div class="container-fluid">
    <table class="table" id="queriesinflight">
    <thead><tr>
        <th>id</th><th>type</th><th>user</th><th>statement</th><th>client ip</th><th>rows</th><th>startTime</th><th>endTime</th>
    </tr></thead>
    <tbody>
    </tbody>
    </table>
</div>

<H2>Complete Queries</H2>
<div class="container-fluid">
    <table class="table" id="queriescomplete">
    <thead><tr>
        <th>id</th><th>type</th><th>user</th><th>statement</th><th>client ip</th><th>rows</th><th>startTime</th><th>elapsedTime</th>
    </tr></thead>
    <tbody>
    </tbody>
    </table>
</div>
</body>
</html>

